<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Triathlon Training Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple scroll-to-top button styling */
        #toTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            z-index: 99;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Triathlon Training Plan</h1>
            <p class="text-lg text-gray-600 mt-2">Your roadmap to race day!</p>
        </header>

        <div id="training-plan" class="space-y-4">
            <!-- Training data will be injected here by JavaScript -->
        </div>
    </div>

    <!-- Scroll to top button -->
    <button id="toTopBtn" class="bg-blue-600 text-white rounded-full p-3 shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <script>
        // Raw CSV data from your updated training plan
        const csvData = `Day,Date,Workout,Details,Recovery Protocol
Mon,Aug 25,Recovery Day,"Sauna + Cold Plunge. Focus on hydration.","(Completed)"
Tues,Aug 26,Long Run Test (Completed),"6.37 miles. Strategy: 9-min run / 1-min walk. Result: Black toenail, pain 3-4/10.","Foot Care: Keep clean & dry. Wear shoes with a wide toe box. Elevate if possible."
Wed,Aug 27,Upper Body Focus & Swim,"AM: PT (lower body). PM: Upper Body Gym. Add a 20-30 min easy recovery swim.","Post-Workout: NormaTec or Hyperice on legs. Sauna: 20 minutes."
Thur,Aug 28,Bike + Sled Hockey,"Bike: 45 mins (monitor toe). Sled Hockey: 1 hour.","Focus on hydration and nutrition post-workout."
Fri,Aug 29,Swim Only,"45-minute swim session. Focus on technique and drills. NO RUNNING.","Post-Swim: NormaTec or Hyperice on legs."
Sat,Aug 30,Sled Hockey Exhibition Game,"","Post-Game: Light stretching."
Sun,Aug 31,Travel / Rest,"","Focus on hydration during travel."
Mon,Sep 1,Open Water Swim,"30-40 minutes at a steady, comfortable pace.","Evening: Restorative Yoga."
Tues,Sep 2,Bodyweight Circuit,"3 rounds: 20 squats, 15 push-ups, 30-sec plank, 20 lunges.",""
Wed,Sep 3,Open Water Swim,"20 mins, with some faster efforts (4 x 2 mins at RPE 7-8).",""
Thur,Sep 4,Bodyweight Circuit,"3 rounds as above.",""
Fri,Sep 5,Open Water Swim,"30 minutes, steady pace.",""
Sat,Sep 6,Travel / Rest,"",""
Sun,Sep 7,Welcome Back Run,"3 miles, very easy pace (RPE 5-6). Shake out the travel.",""
Mon,Sep 8,Swim,"Swim: 1,500 yards, focus on technique.",""
Tues,Sep 9,Bike,"Bike: 12 miles, with some hills if possible.",""
Wed,Sep 10,Personal Training,"Lower body strength.","Post-Workout: NormaTec or Hyperice on legs. Sauna: 20 minutes."
Thur,Sep 11,Run + Upper Body,"Run: 3.5 miles, using a 9 min run / 1 min walk strategy. Upper Body: Strength routine.",""
Fri,Sep 12,Rest or Light Swim,"Active recovery.",""
Sat,Sep 13,Brick Workout,"Bike: 15 miles. Run: 1.5 miles immediately after.",""
Sun,Sep 14,Long Run,"4.5 miles, using the 9 min run / 1 min walk strategy.",""
Mon,Sep 15,Swim + Recovery,"Swim: 1,800 yards, with 3 x 500 at a strong, steady pace.","Evening: Restorative Yoga."
Tues,Sep 16,Personal Training,"PT Session (Suggest Lower Body).","Post-Workout: NormaTec or Hyperice on legs. Sauna: 20 minutes."
Wed,Sep 17,Bike,"Bike: 18 miles, including 3 x 10-minute intervals at a hard pace (RPE 8).",""
Thur,Sep 18,Personal Training + Run,"PT Session (Suggest Upper Body). Follow with a short 2-mile run.","Post-Workout: NormaTec or Hyperice on legs."
Fri,Sep 19,Rest,"Your body will need this before a big weekend.","Focus on hydration and sleep."
Sat,Sep 20,Brick Workout,"Bike: 20 miles. Run: 2 miles. Sled Hockey.",""
Sun,Sep 21,Long Run,"6 miles. Key confidence-building run.","HIGH PRIORITY: Contrast Therapy (Sauna + Cold Plunge) within a few hours of finishing. (Worth the extra trip)."
Mon,Sep 22,Swim + Recovery,"Swim: 800 yards, very easy.","Evening: Restorative Yoga."
Tues,Sep 23,Personal Training,"PT Session (Upper Body Focus). Keep it light. Sled Hockey: light effort.","Post-Workout: NormaTec or Hyperice on legs. Sauna: 20 minutes."
Wed,Sep 24,Bike,"30-40 mins, very easy spin (RPE 4). Focus on high cadence.",""
Thur,Sep 25,Rest,"Total rest. Pack your gear.",""
Fri,Sep 26,Travel + Light Swim,"Travel to race location. Swim: 10-15 minutes in the open water to get a feel for it.",""
Sat,Sep 27,Packet Pickup + Bike/Run,"Packet pickup. Bike: 15 mins. Run: 10 mins. Very easy, just to keep the body loose.",""
Sun,Sep 28,RACE DAY!,"Go out there and have fun!",""`;

        /**
         * Parses a string of CSV data into an array of objects.
         * @param {string} csv - The CSV data as a string.
         * @returns {Array<Object>} An array of objects representing the parsed data.
         */
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(header => header.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                // This regex handles commas inside quoted strings
                const values = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const entry = {};
                for (let j = 0; j < headers.length; j++) {
                    let value = values[j] ? values[j].trim() : '';
                    // Remove quotes from the value if they exist
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.substring(1, value.length - 1);
                    }
                    entry[headers[j]] = value;
                }
                data.push(entry);
            }
            return data;
        }

        /**
         * Renders the training plan data into the DOM.
         * @param {Array<Object>} data - The parsed training plan data.
         */
        function displayPlan(data) {
            const container = document.getElementById('training-plan');
            if (!container) return;

            // Get today's date in a format that matches the CSV (e.g., "Aug 26")
            const today = new Date();
            const todayFormatted = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            
            let currentDayFound = false;

            data.forEach(item => {
                const isToday = item.Date === todayFormatted;
                
                let cardClasses = 'bg-white p-6 rounded-lg shadow-md border-l-4 transition-all duration-300';
                if (isToday) {
                    cardClasses += ' border-blue-500 scale-105 shadow-xl';
                    currentDayFound = true;
                } else {
                    cardClasses += ' border-gray-200';
                }

                const card = document.createElement('div');
                card.className = cardClasses;
                
                if (isToday) {
                    card.id = 'today';
                }
                
                // Build the recovery protocol section only if data exists
                let recoveryHTML = '';
                if (item['Recovery Protocol']) {
                    recoveryHTML = `
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <h3 class="text-md font-semibold text-green-700">Recovery Protocol</h3>
                        <p class="mt-1 text-gray-600">${item['Recovery Protocol']}</p>
                    </div>
                    `;
                }

                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">${item.Workout}</h2>
                        <span class="text-sm font-medium ${isToday ? 'text-blue-600' : 'text-gray-500'}">${item.Day}, ${item.Date}</span>
                    </div>
                    <p class="mt-2 text-gray-600">${item.Details || 'No details provided.'}</p>
                    ${recoveryHTML}
                `;
                container.appendChild(card);
            });
            
            if(currentDayFound) {
                const todayElement = document.getElementById('today');
                if(todayElement) {
                    todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // --- Scroll-to-top button logic ---
        const toTopBtn = document.getElementById('toTopBtn');

        window.onscroll = function() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                toTopBtn.style.display = "block";
            } else {
                toTopBtn.style.display = "none";
            }
        };

        toTopBtn.addEventListener('click', () => {
             document.body.scrollTop = 0;
             document.documentElement.scrollTop = 0;
        });

        // Main execution on page load
        document.addEventListener('DOMContentLoaded', () => {
            const trainingData = parseCSV(csvData);
            displayPlan(trainingData);
        });
    </script>
</body>
</html>
